<div class="container">
  <!-- Previous header code remains the same -->
  <div class="row">
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h3 class="mb-0"><%= attempt.exam.title %></h3>
              <div class="d-flex align-items-center">
                <div class="me-4">
                  <strong>Time Remaining:</strong>
                  <span id="timer" data-end-time="<%= attempt.endTime.getTime() %>" style="font-weight: bold; font-size: 1.2em; margin-left: 10px;">Initializing...</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <form id="examForm" method="POST" action="/exams/<%= attempt.exam._id %>/attempt/<%= attempt._id %>/submit" onsubmit="return validateForm(event)">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        
        <% attempt.questions.forEach((questionAttempt, index) => { %>
          <div class="card mb-4" id="question-card-<%= index %>">
            <div class="card-header">
              <h5 class="mb-0">Question <%= index + 1 %></h5>
            </div>
            <div class="card-body">
              <p class="mb-3"><%= questionAttempt.question.text %></p>
              
              <% if (questionAttempt.question.type === 'MCQ') { %>
                <div class="list-group">
                  <% questionAttempt.question.options.forEach(option => { %>
                    <label class="list-group-item">
                      <input type="radio" 
                             name="answer_<%= questionAttempt.question._id %>" 
                             value="<%= option._id %>"
                             class="me-2 question-input"
                             data-question-index="<%= index %>"
                             required
                             <%= questionAttempt.answer === option._id.toString() ? 'checked' : '' %>>
                      <%= option.text %>
                    </label>
                  <% }); %>
                </div>
              
              <% } else if (questionAttempt.question.type === 'TrueFalse') { %>
                <div class="list-group">
                  <label class="list-group-item">
                    <input type="radio" 
                           name="answer_<%= questionAttempt.question._id %>" 
                           value="true"
                           class="me-2 question-input"
                           data-question-index="<%= index %>"
                           required
                           <%= questionAttempt.answer === 'true' ? 'checked' : '' %>>
                    True
                  </label>
                  <label class="list-group-item">
                    <input type="radio" 
                           name="answer_<%= questionAttempt.question._id %>" 
                           value="false"
                           class="me-2 question-input"
                           data-question-index="<%= index %>"
                           required
                           <%= questionAttempt.answer === 'false' ? 'checked' : '' %>>
                    False
                  </label>
                </div>
              
              <% } else { %>
                <textarea class="form-control question-input" 
                          name="answer_<%= questionAttempt.question._id %>" 
                          rows="4"
                          data-question-index="<%= index %>"
                          required
                          minlength="1"
                          placeholder="Enter your answer here"><%= questionAttempt.answer %></textarea>
              <% } %>

              <div class="mt-2 text-muted">
                <small>
                  <i class="fas fa-star"></i> Marks: <%= questionAttempt.question.marks %>
                  | <i class="fas fa-info-circle"></i> Type: <%= questionAttempt.question.type %>
                </small>
              </div>
              <div class="unanswered-warning mt-2 alert alert-warning d-none">
                <i class="fas fa-exclamation-triangle"></i> Please answer this question before submitting!
              </div>
            </div>
          </div>
        <% }); %>

        <div id="globalWarning" class="alert alert-warning mb-3 d-none">
          <i class="fas fa-exclamation-triangle"></i> Please answer all questions before submitting the exam!
        </div>

        <div class="d-grid gap-2 mb-4">
          <button type="submit" class="btn btn-primary btn-lg"
                  id="submitButton"
                  <%= attempt.status === 'SUBMITTED' ? 'disabled' : '' %>
                  style="<%= attempt.status === 'SUBMITTED' ? 'background-color: #6c757d; border-color: #6c757d;' : '' %>">
            <i class="fas fa-paper-plane"></i> Submit Exam
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="/js/attempt.js"></script>
